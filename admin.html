<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Admin</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body{background:#002b36}
        .admin-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:30px}
        .admin-box{width:760px;background:rgba(255,255,255,0.03);padding:26px;border-radius:12px;box-shadow:0 14px 40px rgba(0,0,0,.45);color:#fff}
        .admin-row{display:flex;gap:16px;align-items:center;margin-bottom:14px}
        .admin-row .label{flex:1;color:#ddd}
        .admin-row input[type=number]{width:120px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff}
        .admin-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:18px}
        .btn{padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
        .btn-primary{background:linear-gradient(90deg,#ff8f3b,#ff6a00);color:#fff}
        .btn-danger{background:#ff4d4d;color:#fff}
        .progress{background:#fff;height:18px;border-radius:12px;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,#ffb26b,#ff7a00,#ff4d00)}
        .small{font-size:13px;color:#ffd7b8}
    </style>
</head>
<body>
    <div class="admin-wrap">
        <div class="admin-box">
            <h2>Admin â€” Support Progress</h2>
            <div class="admin-row">
                <div class="label">Current clicks</div>
                <div id="admin-clicks">0</div>
            </div>
            <div class="admin-row">
                <div class="label">Current goal</div>
                <input id="admin-goal" type="number" min="1">
            </div>

            <div class="admin-row">
                <div class="label">Voting unlocked</div>
                <div id="unlock-status">No</div>
            </div>

            <div style="margin:10px 0">
                <div class="progress" aria-hidden="true"><div id="admin-fill" class="progress-fill" style="width:0%"></div></div>
                <div id="admin-text" class="small" style="margin-top:8px">0 / 100</div>
            </div>

            <div class="admin-actions">
                <button id="reset-btn" class="btn btn-danger">Reset Progress</button>
                <button id="save-goal" class="btn btn-primary">Save Goal</button>
                <button id="toggle-unlock" class="btn">Toggle Unlock Voting</button>
                <button id="signout" class="btn">Sign Out</button>
            </div>
            <div style="margin-top:12px"><a href="index.html">Back to Gallery</a></div>
        </div>
    </div>

<script>
(function(){
    // require session auth
    if (sessionStorage.getItem('photoAdminAuth') !== '1') {
        window.location = 'login.html';
        return;
    }

    const STORAGE_KEY = 'photoSupportClicks';
    const GOAL_KEY = 'photoSupportGoal';

    const adminClicks = document.getElementById('admin-clicks');
    const adminGoalInput = document.getElementById('admin-goal');
    const adminFill = document.getElementById('admin-fill');
    const adminText = document.getElementById('admin-text');
    const resetBtn = document.getElementById('reset-btn');
    const saveGoal = document.getElementById('save-goal');
    const signout = document.getElementById('signout');

    function getClicks(){
        let v = parseInt(localStorage.getItem(STORAGE_KEY) || '0',10);
        if (isNaN(v)) v = 0; return v;
    }
    function getGoal(){
        let g = parseInt(localStorage.getItem(GOAL_KEY) || '100',10);
        if (!g || g < 1) g = 100; return g;
    }
    function render(){
        const clicks = getClicks();
        const goal = getGoal();
        adminClicks.textContent = clicks;
        adminGoalInput.value = goal;
        const pct = Math.min(100, Math.round((clicks / goal) * 100));
        adminFill.style.width = pct + '%';
        adminText.textContent = clicks + ' / ' + goal;
    }

    resetBtn.addEventListener('click', ()=>{
        if (!confirm('Reset progress to 0?')) return;
        localStorage.setItem(STORAGE_KEY,'0');
        render();
    });

    saveGoal.addEventListener('click', ()=>{
        const v = parseInt(adminGoalInput.value,10);
        if (!v || v < 1) { alert('Enter a valid goal (>=1)'); return; }
        localStorage.setItem(GOAL_KEY, String(v));
        render();
        alert('Goal updated');
    });

    // unlock voting toggle (stored in localStorage). Note: localStorage is per-device,
    // so this toggle affects only the browser where admin clicks it unless you use a backend.
    const toggleUnlock = document.getElementById('toggle-unlock');
    const unlockStatus = document.getElementById('unlock-status');
    function isUnlocked(){ return localStorage.getItem('photoSupportUnlocked') === '1'; }
    function setUnlocked(v){ localStorage.setItem('photoSupportUnlocked', v ? '1' : '0'); }

    toggleUnlock.addEventListener('click', ()=>{
        const newState = !isUnlocked();
        setUnlocked(newState);
        render();
    });

    function render(){
        const clicks = getClicks();
        const goal = getGoal();
        adminClicks.textContent = clicks;
        adminGoalInput.value = goal;
        const pct = Math.min(100, Math.round((clicks / goal) * 100));
        adminFill.style.width = pct + '%';
        adminText.textContent = clicks + ' / ' + goal;
        unlockStatus.textContent = isUnlocked() ? 'Yes' : 'No';
        toggleUnlock.textContent = isUnlocked() ? 'Lock Voting' : 'Unlock Voting';
    }

    signout.addEventListener('click', ()=>{
        sessionStorage.removeItem('photoAdminAuth');
        window.location = 'index.html';
    });

    render();
})();
</script>
</body>
</html>